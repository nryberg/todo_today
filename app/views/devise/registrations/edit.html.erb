<div class="auth-container">
  <div class="auth-card">
    <div class="auth-header">
      <h2>Profile Settings</h2>
      <p>Manage your account information</p>
    </div>

    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put, class: "auth-form" }) do |f| %>
      <%= render "devise/shared/error_messages", resource: resource %>

      <!-- User Avatar Section -->
      <% if current_user.avatar_url.present? %>
        <div class="avatar-section">
          <%= image_tag current_user.avatar_url, class: "profile-avatar", alt: current_user.display_name %>
          <p class="avatar-note">Avatar from <%= current_user.provider&.capitalize || 'Google' %></p>
        </div>
      <% end %>

      <!-- Basic Information -->
      <div class="form-section">
        <h3>Basic Information</h3>

        <div class="form-group">
          <%= f.label :name, "Full Name" %>
          <%= f.text_field :name,
              class: "form-control",
              placeholder: "Enter your full name" %>
        </div>

        <div class="form-group">
          <%= f.label :email, "Email Address" %>
          <%= f.email_field :email,
              autofocus: true,
              autocomplete: "email",
              class: "form-control",
              placeholder: "Enter your email" %>
          <% if current_user.social_login? %>
            <small class="form-note">Email from <%= current_user.provider.capitalize %> account</small>
          <% end %>
        </div>

        <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
          <div class="form-note warning">
            Currently waiting confirmation for: <%= resource.unconfirmed_email %>
          </div>
        <% end %>
      </div>

      <!-- Password Section - Only for non-OAuth users -->
      <% unless current_user.social_login? %>
        <div class="form-section">
          <h3>Change Password</h3>

          <div class="form-group">
            <%= f.label :password, "New Password" %>
            <%= f.password_field :password,
                autocomplete: "new-password",
                class: "form-control",
                placeholder: "Leave blank to keep current password" %>
            <small class="form-note">
              <% if @minimum_password_length %>
                <%= @minimum_password_length %> characters minimum
              <% end %>
            </small>
          </div>

          <div class="form-group">
            <%= f.label :password_confirmation, "Confirm New Password" %>
            <%= f.password_field :password_confirmation,
                autocomplete: "new-password",
                class: "form-control",
                placeholder: "Confirm your new password" %>
          </div>

          <div class="form-group">
            <%= f.label :current_password, "Current Password" %>
            <%= f.password_field :current_password,
                autocomplete: "current-password",
                class: "form-control",
                placeholder: "Enter current password to save changes" %>
            <small class="form-note">Required to confirm your changes</small>
          </div>
        </div>
      <% else %>
        <!-- Hidden field for OAuth users -->
        <%= f.hidden_field :current_password, value: "oauth_user" %>
      <% end %>

      <!-- Account Statistics -->
      <div class="form-section">
        <h3>Account Statistics</h3>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-number"><%= current_user.tasks.count %></span>
            <span class="stat-label">Total Tasks</span>
          </div>
          <div class="stat-item">
            <span class="stat-number"><%= current_user.overall_completion_rate %>%</span>
            <span class="stat-label">Overall Rate</span>
          </div>
          <div class="stat-item">
            <span class="stat-number"><%= current_user.task_completions.count %></span>
            <span class="stat-label">Completions</span>
          </div>
          <div class="stat-item">
            <span class="stat-number"><%= time_ago_in_words(current_user.created_at) %></span>
            <span class="stat-label">Member Since</span>
          </div>
        </div>
      </div>

      <!-- Save Changes Button -->
      <div class="form-actions">
        <%= f.submit "Update Profile", class: "btn btn-primary btn-full" %>
      </div>
    <% end %>

    <!-- Danger Zone -->
    <div class="danger-zone">
      <h3>Danger Zone</h3>
      <p>Once you delete your account, there is no going back. This will permanently delete all your tasks and data.</p>
      <%= button_to "Delete Account",
          registration_path(resource_name),
          data: {
            confirm: "Are you sure you want to delete your account? This action cannot be undone.",
            turbo_confirm: "Are you sure you want to delete your account? This action cannot be undone."
          },
          method: :delete,
          class: "btn btn-danger" %>
    </div>

    <div class="auth-links">
      <%= link_to "Back to Tasks", tasks_path %>
    </div>
  </div>
</div>

<style>
.avatar-section {
  text-align: center;
  margin-bottom: 2rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid #f1f5f9;
}

.profile-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border: 3px solid #e2e8f0;
  margin-bottom: 0.5rem;
}

.avatar-note {
  color: #64748b;
  font-size: 0.875rem;
  margin: 0;
}

.form-section {
  margin-bottom: 2rem;
}

.form-section h3 {
  color: #1e293b;
  font-size: 1.125rem;
  font-weight: 600;
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid #f1f5f9;
}

.form-note {
  display: block;
  margin-top: 0.25rem;
  font-size: 0.8rem;
  color: #64748b;
}

.form-note.warning {
  color: #f59e0b;
  background: #fef3c7;
  padding: 0.5rem;
  border-radius: 4px;
  border-left: 3px solid #f59e0b;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}

.stat-item {
  text-align: center;
  padding: 1rem;
  background: #f8fafc;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
}

.stat-number {
  display: block;
  font-size: 1.5rem;
  font-weight: 700;
  color: #667eea;
  margin-bottom: 0.25rem;
}

.stat-label {
  display: block;
  font-size: 0.8rem;
  color: #64748b;
  font-weight: 500;
}

.danger-zone {
  margin-top: 2rem;
  padding: 1.5rem;
  background: #fef2f2;
  border: 1px solid #fecaca;
  border-radius: 8px;
}

.danger-zone h3 {
  color: #dc2626;
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.danger-zone p {
  color: #7f1d1d;
  font-size: 0.9rem;
  margin-bottom: 1rem;
}

.btn-danger {
  background: #dc2626;
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  font-size: 0.9rem;
  cursor: pointer;
  transition: background-color 0.2s;
}

.btn-danger:hover {
  background: #b91c1c;
}

@media (max-width: 640px) {
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
  }

  .stat-item {
    padding: 0.75rem 0.5rem;
  }

  .stat-number {
    font-size: 1.25rem;
  }
}
</style>
